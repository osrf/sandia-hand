<?xml version="1.0"?>

<robot name="sandia_hand"
       xmlns:xacro="http://www.ros.org/wiki/xacro">

  <include filename="$(find sandia_hand_description)/urdf/sandia_hand.gazebo.xacro" />
  <include filename="$(find sandia_hand_description)/urdf/sandia_hand.transmission.xacro" />

  <xacro:macro name="finger" params="idx x y z r p yaw side">
    <link name="${side}_f${idx}_base">
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertial>
        <mass value="0.1"/>
        <origin xyz="0 0 0"/>
        <inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01"/>
      </inertial>
    </link>
    <link name="${side}_f${idx}_fixed_accel">
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertial>
        <mass value="0.1"/>
        <origin xyz="0 0 0"/>
        <inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01"/>
      </inertial>
    </link>
    <link name="${side}_f${idx}_0">
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertial>
        <mass value="0.1"/>
        <origin xyz="0 0 0"/>
        <inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01"/>
      </inertial>
      <!-- begin simple shape approximation of f0 -->
      <collision>
        <origin xyz="0 0 0.003" rpy="0 0 0"/>
        <geometry>
          <cylinder>
            <radius>0.015</radius>
            <length>0.023</length>
          </cylinder>
        </geometry>
      </collision>
      <collision>
        <origin xyz="0.011 0 0.003" rpy="1.57 0 0"/>
        <geometry>
          <cylinder>
            <radius>0.01</radius>
            <length>0.023</length>
          </cylinder>
        </geometry>
      </collision>
      <!--   end simple shape approximation of f0 -->
      <!-- begin visual shape approximation of f0 -->
      <visual>
        <origin xyz="0 0 0.003" rpy="0 0 0"/>
        <geometry>
          <cylinder>
            <radius>0.015</radius>
            <length>0.023</length>
          </cylinder>
        </geometry>
        <material name="${side}_sandia_hand_skin_suntan">
          <color rgba="0.7 0.4 0.2 1.0"/>
        </material>
      </visual>
      <visual>
        <origin xyz="0.011 0 0.003" rpy="1.57 0 0"/>
        <geometry>
          <cylinder>
            <radius>0.01</radius>
            <length>0.023</length>
          </cylinder>
        </geometry>
        <material name="${side}_sandia_hand_skin_suntan">
          <color rgba="0.7 0.4 0.2 1.0"/>
        </material>
      </visual>
      <!--   end visual shape approximation of f0 -->
      <!-- begin collision mesh of f0 ->
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://sandia_hand_description/meshes/f0.stl"/>
        </geometry>
      </collision>
      <!-   end collision mesh of f0 -->
      <!-- begin visual mesh of f0 ->
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://sandia_hand_description/meshes/f0.stl"/>
        </geometry>
        <material name="${side}_sandia_hand_skin_suntan">
          <color rgba="0.7 0.4 0.2 1.0"/>
        </material>
      </visual>
      <!-   end visual mesh of f0 -->
    </link>
    <link name="${side}_f${idx}_1">
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertial>
        <mass value="0.1"/>
        <origin xyz="0 0 0"/>
        <inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01"/>
      </inertial>
      <!-- begin simple shape approximation of f1 -->
      <collision>
        <origin xyz="0.024 0 0" rpy="0 1.57 0"/>
        <geometry>
          <cylinder>
            <radius>0.01</radius>
            <length>0.067</length>
          </cylinder>
        </geometry>
      </collision>
      <!--   end simple shape approximation of f1 -->
      <!-- begin visual shape approximation of f1 -->
      <visual>
        <origin xyz="0.024 0 0" rpy="0 1.57 0"/>
        <geometry>
          <cylinder>
            <radius>0.01</radius>
            <length>0.067</length>
          </cylinder>
        </geometry>
        <material name="${side}_sandia_hand_skin">
          <color rgba="0.835 0.655 0.345 1.0"/>
        </material>
      </visual>
      <!--   end visual shape approximation of f1 -->
      <!-- begin collision mesh of f1 ->
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://sandia_hand_description/meshes/f1.stl"/>
        </geometry>
      </collision>
      <!-   end collision mesh of f1 -->
      <!-- begin visual mesh of f1 ->
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://sandia_hand_description/meshes/f1.stl"/>
        </geometry>
        <material name="${side}_sandia_hand_skin">
          <color rgba="0.835 0.655 0.345 1.0"/>
        </material>
      </visual>
      <!-   end visual mesh of f1 -->
    </link>
    <link name="${side}_f${idx}_1_accel">
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertial>
        <mass value="0.1"/>
        <origin xyz="0 0 0"/>
        <inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01"/>
      </inertial>
    </link>
    <link name="${side}_f${idx}_2">
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertial>
        <mass value="0.1"/>
        <origin xyz="0 0 0"/>
        <inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01"/>
      </inertial>
      <!-- begin simple shape approximation of f2 -->
      <collision>
        <origin xyz="0.024 0 0" rpy="0 1.57 0"/>
        <geometry>
          <cylinder>
            <radius>0.009</radius>
            <length>0.057</length>
          </cylinder>
        </geometry>
      </collision>
      <collision>
        <origin xyz="0.052 0 0" rpy="0 0 0"/>
        <geometry>
          <sphere>
            <radius>0.009</radius>
          </sphere>
        </geometry>
      </collision>
      <!--   end simple shape approximation of f2 -->
      <!-- begin visual shape approximation of f2 -->
      <visual>
        <origin xyz="0.024 0 0" rpy="0 1.57 0"/>
        <geometry>
          <cylinder>
            <radius>0.009</radius>
            <length>0.057</length>
          </cylinder>
        </geometry>
        <material name="${side}_sandia_hand_skin_suntan">
          <color rgba="0.8 0.6 0.3 1.0"/>
        </material>
      </visual>
      <visual>
        <origin xyz="0.052 0 0" rpy="0 0 0"/>
        <geometry>
          <sphere>
            <radius>0.009</radius>
          </sphere>
        </geometry>
        <material name="${side}_sandia_hand_skin_suntan">
          <color rgba="0.8 0.6 0.3 1.0"/>
        </material>
      </visual>
      <!-- begin collision mesh of f2    ->
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://sandia_hand_description/meshes/f2.stl"/>
        </geometry>
      </collision>
      <!-   end collision mesh of f2 -->
      <!-- begin visual mesh of f2    ->
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://sandia_hand_description/meshes/f2.stl"/>
        </geometry>
        <material name="${side}_sandia_hand_skin_suntan">
          <color rgba="0.8 0.6 0.3 1.0"/>
        </material>
      </visual>
      <!-   end visual mesh of f2 -->
    </link>
    <link name="${side}_f${idx}_2_accel">
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertial>
        <mass value="0.1"/>
        <origin xyz="0 0 0"/>
        <inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01"/>
      </inertial>
    </link>

    <joint name="${side}_f${idx}_base" type="fixed">
      <parent link="${side}_palm"/>
      <child link="${side}_f${idx}_base"/>
      <origin xyz="${x} ${y} ${z}" rpy="${r} ${p} ${yaw}"/>
    </joint>
    <joint name="${side}_f${idx}_j0" type="revolute">
      <axis xyz="0 0 1"/>
      <parent link="${side}_f${idx}_base"/>
      <child link="${side}_f${idx}_0"/>
      <limit lower="-1.57079" upper="1.57079" effort="1" velocity="1"/>
      <safety_controller soft_lower_limit="${-1.57079-10.0}" soft_upper_limit="${1.57079+10.0}" k_position="1000.0" k_velocity="1000.0"/>
      <dynamics damping="0.1"/>
      <origin xyz="0 0 0" rpy="0 0 0"/>
    </joint>
    <joint name="${side}_f${idx}_j1" type="revolute">
      <axis xyz="0 0 1"/>
      <parent link="${side}_f${idx}_0"/>
      <child link="${side}_f${idx}_1"/>
      <limit lower="-1.57079" upper="1.57079" effort="1" velocity="1"/>
      <safety_controller soft_lower_limit="${-1.57079-10.0}" soft_upper_limit="${1.57079+10.0}" k_position="1000.0" k_velocity="1000.0"/>
      <dynamics damping="0.1"/>
      <origin xyz="0.028 0 0" rpy="1.57079 0 0"/>
    </joint>
    <joint name="${side}_f${idx}_j2" type="revolute">
      <axis xyz="0 0 1"/>
      <parent link="${side}_f${idx}_1"/>
      <child link="${side}_f${idx}_2"/>
      <origin xyz="0.05 0 0" rpy="0 0 0"/>
      <safety_controller soft_lower_limit="${-1.57079-10.0}" soft_upper_limit="${1.57079+10.0}" k_position="1000.0" k_velocity="1000.0"/>
      <dynamics damping="0.1"/>
      <limit lower="-1.57079" upper="1.57079" effort="1" velocity="1"/>
    </joint>

    <joint name="${side}_f${idx}_fixed_accel" type="fixed">
      <parent link="${side}_f${idx}_base"/>
      <child link="${side}_f${idx}_fixed_accel"/>
      <origin xyz="-0.05 0 0" rpy="0 0 0"/>
    </joint>
    <joint name="${side}_f${idx}_1_accel" type="fixed">
      <parent link="${side}_f${idx}_1"/>
      <child link="${side}_f${idx}_1_accel"/>
      <origin xyz="0.03 0 0" rpy="-1.5709 0 0"/>
    </joint>
    <joint name="${side}_f${idx}_2_accel" type="fixed">
      <parent link="${side}_f${idx}_2"/>
      <child link="${side}_f${idx}_2_accel"/>
      <origin xyz="0.04 0 0" rpy="-1.5709 0 0"/>
    </joint>

    <xacro:finger_transmission side="${side}" idx="${idx}" x="${x}" y="${y}" z="${z}" r="${r}" p="${p}" yaw="${yaw}"/>
  </xacro:macro>

  <xacro:macro name="sandia_hand" params="side parent *origin">
    <link name="${side}_palm">
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertial>
        <mass value="0.1"/>
        <origin xyz="0 0 0"/>
        <inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01"/>
      </inertial>
      <!-- begin simple shape approximation of palm -->
      <collision>
        <origin xyz="0.069 0.016 0.038" rpy="0 1.57 -0.9"/>
        <geometry>
          <cylinder>
            <radius>0.013</radius>
            <length>0.100</length>
          </cylinder>
        </geometry>
      </collision>
      <collision>
        <origin xyz="0.064 0.008 0.021" rpy="0.41 0 -0.9"/>
        <geometry>
          <box>
            <size>0.09 .035 .05</size>
          </box>
        </geometry>
      </collision>
      <collision>
        <origin xyz="0.02 0 -0.005" rpy="0 1.57 0"/>
        <geometry>
          <cylinder>
            <radius>0.038</radius>
            <length>0.05</length>
          </cylinder>
        </geometry>
      </collision>
      <collision>
        <origin xyz="0.11 -0.01 -0.005" rpy="0 0 0.37"/>
        <geometry>
          <box>
            <size>0.09 .03 .06</size>
          </box>
        </geometry>
      </collision>
      <collision>
        <origin xyz="0.09 0.02 -0.005" rpy="0 0 0.37"/>
        <geometry>
          <box>
            <size>0.09 .03 .06</size>
          </box>
        </geometry>
      </collision>
      <collision>
        <origin xyz="0.060 0.050 -0.005" rpy="0 0 0.37"/>
        <geometry>
          <box>
            <size>0.09 .03 .06</size>
          </box>
        </geometry>
      </collision>
      <collision>
        <origin xyz="0.044 -0.04 -0.005" rpy="0 0 0.79"/>
        <geometry>
          <box>
            <size>0.09 .03 .06</size>
          </box>
        </geometry>
      </collision>
      <!--   end simple shape approximation of palm -->
      <!-- begin visual shape approximation of palm -->
      <visual>
        <origin xyz="0.069 0.016 0.038" rpy="0 1.57 -0.9"/>
        <geometry>
          <cylinder>
            <radius>0.013</radius>
            <length>0.100</length>
          </cylinder>
        </geometry>
        <material name="${side}_sandia_hand_skin">
          <color rgba="0.835 0.655 0.345 1.0"/>
        </material>
      </visual>
      <visual>
        <origin xyz="0.064 0.008 0.021" rpy="0.41 0 -0.9"/>
        <geometry>
          <box>
            <size>0.09 .035 .05</size>
          </box>
        </geometry>
        <material name="${side}_sandia_hand_skin">
          <color rgba="0.835 0.655 0.345 1.0"/>
        </material>
      </visual>
      <visual>
        <origin xyz="0.02 0 -0.005" rpy="0 1.57 0"/>
        <geometry>
          <cylinder>
            <radius>0.038</radius>
            <length>0.05</length>
          </cylinder>
        </geometry>
        <material name="${side}_sandia_hand_skin">
          <color rgba="0.835 0.655 0.345 1.0"/>
        </material>
      </visual>
      <visual>
        <origin xyz="0.11 -0.01 -0.005" rpy="0 0 0.37"/>
        <geometry>
          <box>
            <size>0.09 .03 .06</size>
          </box>
        </geometry>
        <material name="${side}_sandia_hand_skin">
          <color rgba="0.835 0.655 0.345 1.0"/>
        </material>
      </visual>
      <visual>
        <origin xyz="0.09 0.02 -0.005" rpy="0 0 0.37"/>
        <geometry>
          <box>
            <size>0.09 .03 .06</size>
          </box>
        </geometry>
        <material name="${side}_sandia_hand_skin">
          <color rgba="0.835 0.655 0.345 1.0"/>
        </material>
      </visual>
      <visual>
        <origin xyz="0.060 0.050 -0.005" rpy="0 0 0.37"/>
        <geometry>
          <box>
            <size>0.09 .03 .06</size>
          </box>
        </geometry>
        <material name="${side}_sandia_hand_skin">
          <color rgba="0.835 0.655 0.345 1.0"/>
        </material>
      </visual>
      <visual>
        <origin xyz="0.044 -0.04 -0.005" rpy="0 0 0.79"/>
        <geometry>
          <box>
            <size>0.09 .03 .06</size>
          </box>
        </geometry>
        <material name="${side}_sandia_hand_skin">
          <color rgba="0.835 0.655 0.345 1.0"/>
        </material>
      </visual>
      <!--   end visual shape approximation of palm -->
      <!-- begin collision mesh of f2 ->
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://sandia_hand_description/meshes/palm.stl"/>
        </geometry>
      </collision>
      <!-   end collision mesh of f2 -->
      <!-- begin visual mesh of f2    ->
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://sandia_hand_description/meshes/palm.stl"/>
        </geometry>
        <material name="${side}_sandia_hand_skin">
          <color rgba="0.835 0.655 0.345 1.0"/>
        </material>
      </visual>
      <!-   end visual mesh of f2 -->
    </link>

    <joint name="${side}_sandia_hand_joint" type="fixed">
      <parent link="${parent}"/>
      <child link="${side}_palm"/>
      <insert_block name="origin" />
    </joint>

    <xacro:finger side="${side}" idx="0" x="0.140" y="0.00000" z="0" r="0" p="0" yaw="0.3"/>
    <xacro:finger side="${side}" idx="1" x="0.115" y="0.03122" z="0" r="0" p="0" yaw="0.3"/>
    <xacro:finger side="${side}" idx="2" x="0.090" y="0.06245" z="0" r="0" p="0" yaw="0.3"/>
    <xacro:finger side="${side}" idx="3" x="0.03995" y="-0.04383" z="0.014" r="0" p="-1.57079" yaw="-2.3562"/>

    <!-- not needed unless simulating the hand by itself
    <xacro:sandia_hand_gazebo side="${side}" />
    -->

  </xacro:macro>
</robot>

